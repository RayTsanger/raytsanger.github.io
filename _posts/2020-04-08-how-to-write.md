---
layout: post
title: 自控系统与监控系统的融合（基于西门子PLC和组态王）
date: 2020-04-08
categories: blog
description: 文章金句。
---

&emsp;&emsp;摘要：随着工业自动化的发展，许多企业生产过程实现了自动远程控制，然而某些生产场合必须配备视频监控作为辅助手段，才能全面直观地进行生产控制。传统的工业自控系统与视频监控系统无论从硬件还是软件都是相互独立的，使得控制人员在使用时必须在两个系统间来回操作，影响了生产效率。为此，本文设计了一套基于西门子PLC自控系统与视频监控的融合应用方案，在硬件上将视频监控接入到工业以太网，在软件上将视频监控接入到组态软件中，从而实现PLC自控系统与视频监控系统的统一控制。  
&emsp;&emsp;关键词：西门子PLC；视频监控；工业以太网；融合

&emsp;&emsp;在自动控制系统的设计和实施过程中，经常会有一些场合，除了用工业监控软件进行工艺流程数据监控外，还需要配置专业的视频监控系统，以使中控室能够直观的、全面的掌握现场的实际情况，从而实现安全的远程控制功能。传统的做法一般是另外采用一套独立的模拟信号视频系统，如配置前端设备(含摄像机、镜头、云台、解码器等)、监视器和视频操作键盘;或者采用一套独立的数字信号视频系统，如配置前端设备、带视频采集卡的计算机、视频监控软件。由于视频系统与自控系统相互独立，往往在现场需要各自独立布线，监控中心也需两套监视和操作设备。但这两套系统的最终目标都是为了实现远程控制，所以操作用户希望能够在同一监控画面上同时看到实时数据和图像，以便及时根据现场情况进行快速操作，并减少多种设备的日常操作和维护工作量，还能够使工业控制系统和视频监控系统最大程度地融合。  
&emsp;&emsp;本文综合运用自动控制和视频监控两种不同专业领域的最新技术，设计了一套完整的解决方案，可以在同一监控网络中同时传输数据、视频、控制信号，在同一计算机软件的同一画面中同时进行工情和视频监控，从而实现了工业控制系统与视频监控系统真正意义上的“两网合一”。

1、方案设计  
&emsp;&emsp;工业以太网技术是目前工控领域的一个应用热点，常用的 PLC产品一般可以配置以太网通讯模块（以下以西门子PLC为例讲解），同时常用的监控组态软件也都可以通过以太网与PLC通讯，并且一些功能强大的组态软件具备完整的编程环境，可以通过高级语言编程实现一般应用软件的功能。网络摄像机(或网络视频服务器)是目前视频监控领域的一项新技术，其实质是把来自摄像机的视频信号采集后按照一定的压缩标准(如MPEG4、H.264等)转换为可在以太网上传输的数据包，每个网络摄像机(或网络视频服务器)具有不同的IP地址，网络上的计算机可通过TCP/IP协议连接该摄像机(或服务器)，并通过软件对数据包解压缩还原为实时图像。  
&emsp;&emsp;方案采用SIEMENS S7-300 PLC进行现场设备控制，配置有CPU模块、以太网通讯模块和各种I/O模块；视频监控前端设备为普通摄像机、自动光圈变焦镜头、云台和解码器等，网络数据处理采用二通道视频输入的网络视频服务器，它带有与解码器通讯的RS485端口和与摄像机连接的视频输入BNC端口，输出为可连接到以太网的RJ45端口;监控计算机采用高性能的工控机，大部分组态软件如组态王、WinCC、IFix等均可支持视频监控画面嵌入（以下以组态王为例讲解），该组态软件支持ActiveX控件、VBA编程和各种通讯协议，功能非常强大;通讯网络采用1000M以太网交换机，通过超六类网线连接计算机、PLC和视频服务器。本系统实现的关键是在以太网上同时传输视频信息和控制、数据信息，并在同一组态软件中实现工艺监控和视频监控功能。 
   
2、“两网合一”的具体实现  
&emsp;&emsp;2.1 PLC组态和编程  
&emsp;&emsp;在SIMATIC STEP7中进行PLC硬件和网络组态，以太网模块的IP地址可设置为192.168.0.2，子网掩码为255.255.255.0。在DB块中建立与上位机通讯用的变量，包括BOOL、INT等数据类型。然后编制多个FC控制程序，通过MPI电缆下载到PLC中。  
&emsp;&emsp;2.2 视频设备设置  
&emsp;&emsp;视频设备主要有摄像机、镜头、云台、解码器和视频服务器。解码器通过标准电压信号控制云台上下左右动作和镜头的变焦、聚焦调节，它与视频服务器之间通过 RS485总线进行通讯，每个解码器要设置不同的通讯地址如1和2。视频服务器通过设置软件设定其IP地址、子网掩码等参数，如IP地址为192.168.0.64，子网掩码为255.255.255.0。  
&emsp;&emsp;2.3 监控软件的综合开发  
&emsp;&emsp;2.3.1 连接网络摄像头，把电脑IP与PLC IP、摄像头IP改为同一网段内。     
&emsp;&emsp;2.3.2 注册海康威视摄像头OCX控件。在文件上右键点击打开方式，找到regsvr32.exe点打开，再确定。   

![image](https://i.loli.net/2020/04/08/UErdx2KJ6cy1zAn.png)

&emsp;&emsp;2.3.3 在工程画面中点击插入通用控件。

![image](https://i.loli.net/2020/04/08/buqtkSei85raWK9.png)

&emsp;&emsp;2.3.4 选择NetVideoActiveX23控件。

![image](https://i.loli.net/2020/04/08/ReEPasJMYXZbgBq.png)

&emsp;&emsp;2.3.5 添加控制按钮。

![image](https://i.loli.net/2020/04/08/7FdW6mn1MkIicNa.png)

&emsp;&emsp;2.3.6 更改字符串为需要显示文字。

![image](https://i.loli.net/2020/04/08/1QFckjnwLTVDtME.png)

&emsp;&emsp;2.3.7 双击打开动画连接属性，点击按下时出现命令语言页面写入需要的命令，点击确定退出。

![image](https://i.loli.net/2020/04/08/e1BN2MOqmgfFkEp.png)

![image](https://i.loli.net/2020/04/08/G1XuwB3tsYb8KRl.png)

&emsp;&emsp;2.3.8 点击开发画面中文件---全部存，保存画面。  
&emsp;&emsp;2.3.9 点击开发画面中文件---切换到View，打开运行画面，点击登录，开始预览，即可显示摄像头监控画面。

![image](https://i.loli.net/2020/04/08/GwV3fFMnt4zEKNb.png)

&emsp;&emsp;2.3.10 常用命令语言如下  
    &emsp;&emsp;a、登录Login("192.0.0.64",8000,"admin","12345");  
    &emsp;&emsp;b、开始预览StartRealPlay(0,0,0);  
    &emsp;&emsp;c、云台开始命令PTZCtrlStart(0,3);（0 -- 云台向上，1 -- 云台向下，2 -- 云台向左，3 -- 云台向右， 4 -- 焦距缩进，5 -- 焦距拉远，6 -- 焦点近，7 -- 焦点远，8 -- 光圈小，9 -- 光圈大，10 – 自动,  11 – 灯光， 12 – 雨刷，13 - 云台左上, 14 - 云台右上, 15 - 云台左下, 16 - 云台右下）。  
    &emsp;&emsp;d、云台停止PTZCtrlStop(0,3);（0 -- 云台向上，1 -- 云台向下，2 -- 云台向左，3 -- 云台向右， 4 -- 焦距缩进，5 -- 焦距拉远，6 -- 焦点近，7 -- 焦点远，8 -- 光圈小，9 -- 光圈大，10 – 自动,  11 – 灯光， 12 – 雨刷，13 - 云台左上, 14 - 云台右上, 15 - 云台左下, 16 - 云台右下）。  
3、结语  
&emsp;&emsp;本文设计的自动控制系统和视频监控系统“两网合一”方案具有以下特点：  
&emsp;&emsp;(1) 是一个开放的系统，PLC站、视频监控点、监控计算机都可根据需要随时增减，系统扩展不需要结构改变;  
&emsp;&emsp;(2) 可以把视频服务器、视频前端设备和PLC控制站放置在现场，只要一根网线即可与监控中心的计算机连接，大大减少了布线;  
&emsp;&emsp;(3) 监控中心只需要一台计算机和一套监控软件即可实现全部监控功能，既便于操作又减少维护工作量;  
&emsp;&emsp;(4) 采用视频服务器比采用视频采集卡更能分散计算机数据处理的工作量，而且使控制和视频真正在同一网络传输，更适用于远程网络监控。










